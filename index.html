<script type="module">
  // ... інші імпорти і змінні залишаються без змін

  function animate() {
    const time = Date.now() * 0.005;
    flag.rotation.z = Math.sin(time * 0.2) * 0.1;
    beacon.material.color.setHSL(Math.sin(time * 0.5) * 0.5 + 0.5, 1, 0.5);

    if (hasTakenOff && bayraktar) {
      if (cameraMode === 1) {
        // Камера на хвості
        const tail = new THREE.Vector3(0, 1.2, 3);
        tail.applyMatrix4(bayraktar.matrixWorld);
        camera.position.lerp(tail, 0.2);

        const lookAhead = new THREE.Vector3(0, 1, -5);
        lookAhead.applyMatrix4(bayraktar.matrixWorld);
        camera.lookAt(lookAhead);
      } else if (cameraMode === 2) {
        // Попередній вигляд (кіно)
        const behind = new THREE.Vector3(0, 2, 8);
        behind.applyMatrix4(bayraktar.matrixWorld);
        camera.position.lerp(behind, 0.1);
        camera.lookAt(bayraktar.position);
      } else if (cameraMode === 3) {
        // Вільна камера
        controls.enabled = true;
        controls.target.copy(bayraktar.position);
        controls.update();
      }
    }

    requestAnimationFrame(animate);
    checkTakeOff();
    moveBayraktar();
    updateMissiles();
    controls.update();
    renderer.render(scene, camera);
  }

  animate();
</script>
